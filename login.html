<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>管理员登录</title>
    <link rel="shortcut icon" href="img/xy.ico" type="image/x-icon" />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      :root {
        --color-bg: #0d1117;
        --color-text: #c9d1d9;
        --color-border: #30363d;
        --color-btn: #238636;
        --color-btn-hover: #2ea043;
        --color-input-bg: #0d1117;
        --color-error: #f85149;
        --cursor-x: 50%;
        --cursor-y: 50%;
        --input-x: 50%;
        --input-y: 50%;
        --glow-color: rgba(88, 166, 255, 0.15);
      }

      body {
        min-height: 100vh;
        background-color: var(--color-bg);
        display: flex;
        justify-content: center;
        align-items: center;
        color: var(--color-text);
      }

      body::before {
        content: "";
        position: fixed;
        width: 300px;
        height: 300px;
        background: radial-gradient(
          circle at center,
          var(--glow-color),
          transparent 70%
        );
        pointer-events: none;
        transform: translate(-50%, -50%);
        z-index: 9999;
        transition: all 0.1s ease;
        left: var(--cursor-x);
        top: var(--cursor-y);
        filter: blur(5px);
      }

      .container {
        background-color: #161b22;
        padding: 32px;
        border-radius: 6px;
        border: 1px solid var(--color-border);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        width: 100%;
        max-width: 308px;
        text-align: center;
        transition: transform 0.3s ease;
      }

      .container:hover {
        transform: translateY(-10px);
      }

      .github-logo {
        width: 48px;
        height: 48px;
        margin-bottom: 24px;
        filter: brightness(2);
      }

      h2 {
        margin-bottom: 16px;
        font-size: 24px;
        font-weight: 300;
        letter-spacing: -0.5px;
        color: var(--color-text);
        transition: color 0.3s ease;
      }

      h2:hover {
        color: #0366d6;
      }

      .form-group {
        margin-bottom: 16px;
        position: relative;
        overflow: hidden;
      }

      .form-group::after {
        content: "";
        position: absolute;
        width: 200px;
        height: 200px;
        background: radial-gradient(
          circle at var(--input-x) var(--input-y),
          rgba(88, 166, 255, 0.2),
          transparent 70%
        );
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.3s ease;
        transform: translate(-50%, -50%);
        left: var(--input-x);
        top: var(--input-y);
        filter: blur(10px);
      }

      .form-group:hover::after {
        opacity: 1;
      }

      .form-group label {
        display: block;
        text-align: left;
        font-size: 14px;
        font-weight: 400;
        margin-bottom: 8px;
      }

      input {
        width: 100%;
        padding: 5px 12px;
        border: 1px solid var(--color-border);
        border-radius: 6px;
        font-size: 14px;
        line-height: 20px;
        background-color: var(--color-input-bg);
        color: var(--color-text);
        outline: none;
        transition: border-color 0.3s ease, box-shadow 0.3s ease;
      }

      input:focus {
        border-color: #58a6ff;
        box-shadow: 0 0 15px var(--glow-color);
      }

      input:focus + .underline {
        transform: scaleX(1);
      }

      .underline {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: #0366d6;
        transform: scaleX(0);
        transform-origin: left;
        transition: transform 0.3s ease;
      }

      .login-btn {
        width: 100%;
        padding: 8px 16px;
        border: 1px solid rgba(240, 246, 252, 0.1);
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        background-color: var(--color-btn);
        color: #ffffff;
        transition: background 0.3s ease, transform 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .login-btn:hover {
        background-color: var(--color-btn-hover);
        transform: translateY(-2px);
      }

      .login-btn:active {
        animation: rotate 0.3s ease-in-out;
      }

      @keyframes rotate {
        0% {
          transform: rotate(0deg);
        }
        50% {
          transform: rotate(5deg);
        }
        100% {
          transform: rotate(0deg);
        }
      }

      .ripple {
        position: absolute;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.3);
        transform: scale(0);
        animation: ripple-animation 0.6s linear infinite;
      }

      @keyframes ripple-animation {
        to {
          transform: scale(4);
          opacity: 0;
        }
      }

      .error-message {
        color: var(--color-error);
        margin-top: 8px;
        font-size: 12px;
        text-align: left;
        display: none;
        animation: fadeInBlink 0.3s ease forwards;
      }

      @keyframes fadeInBlink {
        0% {
          opacity: 0;
          transform: translateY(-10px);
        }
        50% {
          opacity: 1;
          transform: translateY(0);
        }
        100% {
          opacity: 0.7;
          transform: translateY(0);
        }
      }

      /* 添加输入框标签 */
      .input-label {
        display: block;
        font-size: 14px;
        font-weight: 500;
        margin-bottom: 8px;
        text-align: left;
      }

      /* 全局光效 */
      .light-effect {
        pointer-events: none;
        position: fixed;
        width: 100%;
        height: 100%;
        left: 0;
        top: 0;
        z-index: 1;
      }

      /* 鼠标跟随光效 */
      .cursor-glow {
        position: fixed;
        width: 400px;
        height: 400px;
        background: radial-gradient(
          circle at center,
          rgba(37, 99, 235, 0.15),
          rgba(37, 99, 235, 0.08) 40%,
          transparent 70%
        );
        transform: translate(-50%, -50%);
        pointer-events: none;
        z-index: 2;
        transition: all 0.15s ease;
        filter: blur(2px);
        left: var(--cursor-x);
        top: var(--cursor-y);
      }

      /* 输入框光效 */
      .form-group {
        position: relative;
        margin-bottom: 1.5rem;
        overflow: hidden;
      }

      .form-group::after {
        content: "";
        position: absolute;
        width: 250px;
        height: 250px;
        background: radial-gradient(
          circle at var(--input-x) var(--input-y),
          rgba(88, 166, 255, 0.2),
          transparent 70%
        );
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.3s ease;
        transform: translate(-50%, -50%);
        left: var(--input-x);
        top: var(--input-y);
        filter: blur(10px);
      }

      .form-group:hover::after {
        opacity: 1;
      }

      /* 按钮光效 */
      .login-btn {
        position: relative;
        overflow: hidden;
      }

      .login-btn::before {
        content: "";
        position: absolute;
        width: 200%;
        height: 200%;
        background: radial-gradient(
          circle at center,
          rgba(255, 255, 255, 0.2),
          transparent 70%
        );
        top: -50%;
        left: -50%;
        transform: scale(0);
        transition: transform 0.3s ease;
      }

      .login-btn:hover::before {
        transform: scale(1);
      }

      #canvas-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 1000;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <img src="./img/favicon.ico" alt="Logo" class="github-logo" />
      <h2>登录到系统</h2>
      <form id="loginForm" onsubmit="event.preventDefault(); login();">
        <div class="form-group">
          <label class="input-label" for="username">用户名</label>
          <input type="text" id="username" autocomplete="username" required />
        </div>
        <div class="form-group">
          <label class="input-label" for="password">密码</label>
          <input
            type="password"
            id="password"
            autocomplete="current-password"
            required
          />
        </div>
        <button type="submit" class="login-btn">登 录</button>
        <p class="error-message" id="errorMessage"></p>
      </form>
    </div>

    <canvas id="canvas-container"></canvas>

    <script>
      async function readJsonFile(filePath) {
        try {
          const response = await fetch(filePath);
          if (!response.ok) {
            throw new Error(
              `Network response was not ok: ${response.statusText}`
            );
          }
          return await response.json();
        } catch (error) {
          console.error("读取文件出错：", error);
          return null;
        }
      }

      async function login() {
        const username = document.getElementById("username").value;
        const password = document.getElementById("password").value;
        console.log("尝试登录:", username); // 调试日志

        try {
            console.log("开始读取 JSON 文件");
            const response = await fetch("./json/login.json");
            
            if (!response.ok) {
                console.error("HTTP错误:", response.status);
                throw new Error(`HTTP错误! status: ${response.status}`);
            }

            const jsonData = await response.json();
            console.log("JSON数据:", jsonData); // 调试日志

            if (!jsonData.users || !Array.isArray(jsonData.users)) {
                console.error("JSON格式错误:", jsonData);
                throw new Error("登录数据格式错误");
            }

            const user = jsonData.users.find(
                u => u.username === username && u.password === password
            );
            
            console.log("用户验证结果:", !!user); // 调试日志

            if (user) {
                localStorage.setItem("isLoggedIn", "true");
                localStorage.setItem("username", username);
                window.location.href = "admin.html";
            } else {
                showError("用户名或密码错误");
            }
        } catch (error) {
            console.error("详细错误信息:", error);
            
            if (error.name === 'TypeError' && error.message.includes('fetch')) {
                showError("无法读取登录信息，请检查网络连接");
            } else if (error.message.includes('JSON')) {
                showError("登录数据格式错误");
            } else {
                showError(`登录失败: ${error.message}`);
            }
        }
      }

      // 显示错误信息的函数
      function showError(message) {
        const errorMessage = document.getElementById("errorMessage");
        errorMessage.textContent = message;
        errorMessage.style.display = "block";
        errorMessage.classList.add("show");

        setTimeout(() => {
          errorMessage.classList.remove("show");
          errorMessage.style.display = "none";
        }, 3000);
      }

      function checkLoginExpiration() {
        const expiration = localStorage.getItem("loginExpiration");
        if (expiration && Date.now() > parseInt(expiration)) {
          localStorage.clear();
        }
      }

      checkLoginExpiration();

      // 添加波纹效果
      function createRipple(event) {
        const button = event.currentTarget;
        const ripple = document.createElement("span");
        const rect = button.getBoundingClientRect();

        ripple.className = "ripple";
        ripple.style.left = `${event.clientX - rect.left}px`;
        ripple.style.top = `${event.clientY - rect.top}px`;

        button.appendChild(ripple);
        ripple.addEventListener("animationend", () => ripple.remove());
      }

      // 修改登录按钮事件监听
      document
        .querySelector(".login-btn")
        .addEventListener("click", function (event) {
          createRipple(event); // 保持波纹效果
        });

      // 添加表单提交事件监听
      document
        .getElementById("loginForm")
        .addEventListener("submit", async function (event) {
          event.preventDefault(); // 阻止表单默认提交
          await login(); // 调用登录函数
        });

      // 修改现有的鼠标移动监听代码
      document.addEventListener("mousemove", (e) => {
        requestAnimationFrame(() => {
          document.body.style.setProperty("--cursor-x", e.clientX + "px");
          document.body.style.setProperty("--cursor-y", e.clientY + "px");
        });
      });

      // 修改输入框光效代码
      const inputElements = document.querySelectorAll("input");
      inputElements.forEach((input) => {
        const formGroup = input.closest(".form-group");

        input.addEventListener("mousemove", (e) => {
          if (formGroup) {
            const rect = formGroup.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            formGroup.style.setProperty("--input-x", `${x}px`);
            formGroup.style.setProperty("--input-y", `${y}px`);
          }
        });

        input.addEventListener("mouseenter", () => {
          if (formGroup) {
            formGroup.style.setProperty(
              "--glow-color",
              "rgba(88, 166, 255, 0.3)"
            );
          }
        });

        input.addEventListener("mouseleave", () => {
          if (formGroup) {
            formGroup.style.setProperty(
              "--glow-color",
              "rgba(88, 166, 255, 0.15)"
            );
          }
        });
      });

      const canvas = document.getElementById("canvas-container");
      const ctx = canvas.getContext("2d");

      // 设置canvas尺寸
      function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }

      // 初始化
      window.addEventListener("resize", resizeCanvas);
      resizeCanvas();

      // 粒子类
      class Particle {
        constructor(x, y) {
          this.x = x;
          this.y = y;
          this.size = Math.random() * 3 + 1;
          this.speedX = Math.random() * 2 - 1;
          this.speedY = Math.random() * 2 - 1;
          this.life = 1;
        }

        update() {
          this.x += this.speedX;
          this.y += this.speedY;
          this.life -= 0.01;
        }

        draw() {
          ctx.beginPath();
          ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
          ctx.fillStyle = `rgba(88, 166, 255, ${this.life})`;
          ctx.fill();
        }
      }

      let particles = [];
      let mouse = {
        x: undefined,
        y: undefined,
      };

      // 鼠标移动事件
      window.addEventListener("mousemove", (e) => {
        mouse.x = e.x;
        mouse.y = e.y;

        // 添加新粒子
        for (let i = 0; i < 3; i++) {
          particles.push(new Particle(mouse.x, mouse.y));
        }
      });

      // 动画循环
      function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // 更新和绘制粒子
        for (let i = particles.length - 1; i >= 0; i--) {
          particles[i].update();
          particles[i].draw();

          if (particles[i].life <= 0) {
            particles.splice(i, 1);
          }
        }

        // 光晕效果
        let gradient = ctx.createRadialGradient(
          mouse.x,
          mouse.y,
          0,
          mouse.x,
          mouse.y,
          100
        );
        gradient.addColorStop(0, "rgba(88, 166, 255, 0.2)");
        gradient.addColorStop(1, "rgba(88, 166, 255, 0)");

        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        requestAnimationFrame(animate);
      }

      animate();

      // 输入框特效
      const inputs = document.querySelectorAll("input");
      inputs.forEach((input) => {
        input.addEventListener("mouseover", () => {
          input.style.boxShadow = "0 0 15px rgba(88, 166, 255, 0.5)";
        });

        input.addEventListener("mouseout", () => {
          input.style.boxShadow = "none";
        });
      });
    </script>
  </body>
</html>
